Functional Doctest For Viewlets
===============================

:Test-Layer: functional

Setup
-----

We have to setup view and context to get our ViewletManager!

   >>> from zope.component import getMultiAdapter
   >>> from zope.publisher.browser import TestRequest
   >>> from zope.contentprovider.interfaces import IContentProvider
   >>> from uvcsite.app import Uvcsite

   >>> import zope.interface
   >>> import zope.security.interfaces
   >>> class DummyPrincipal(object):
   ...     zope.interface.implements(zope.security.interfaces.IPrincipal)
   ...
   ...     id = "uvc.someuser"
   ...     title = "Some User's Name"
   ...     description = "A User"


   >>> import zope.security.management
   >>> request = TestRequest()
   >>> request.setPrincipal(DummyPrincipal())

   >>> root = getRootFolder()
   >>> uvcsite = Uvcsite()
   >>> from zope.securitypolicy.interfaces import IPrincipalRoleManager
   >>> #import pdb; pdb.set_trace()
   >>> root['app'] = uvcsite

Context

   >>> context = root['app']
   >>> context
   <uvcsite.app.Uvcsite object at ...>
   >>> prm = IPrincipalRoleManager(context)
   >>> prm.assignRoleToPrincipal('uvc.User', 'uvc.someuser')
   >>> prm.assignRoleToPrincipal('uvc.ManageUsers', 'uvc.someuser')
   >>> zope.security.management.newInteraction(request)

View

   >>> view = getMultiAdapter((context, request), name=u"index")
   >>> view   
   <uvcsite.tests.views.Index object at ...>

ViewletManagers and their Viewlets
----------------------------------

GlobalMenu
----------

   >>> manager = getMultiAdapter((context, request, view), IContentProvider, name=u"uvcsite.headers")
   >>> manager 
   <uvc.layout.managers.Headers object ...>

Show the viewlets:

   >>> manager.update()
   >>> [x for x in manager.viewlets]
   [<uvc.skin.viewlets.Favicon object at ...>]
 

PersonalPreferences
-------------------

   >>> manager = getMultiAdapter((context, request, view), IContentProvider, name=u"uvc.user.preferences")
   >>> manager 
   <uvc.layout.menus.PersonalPreferences object ...>

Show the Viewlets:

   >>> manager.update()
   >>> for x in manager.viewlets:
   ...     print x
   <uvcsite.viewlets.staticmenuentries.UserName object at ...>
   <uvcsite.viewlets.staticmenuentries.MeinOrdner object at ...>
   <megrok.navigation.util.AutoSiteMenuItem_... object at ...>

We render the individual viewlets:

  >>> [x for x in manager.viewlets]
  [<uvcsite.viewlets.staticmenuentries.UserName object at 0...>, 
   <uvcsite.viewlets.staticmenuentries.MeinOrdner object at 0...>,
   <megrok.navigation.util.AutoSiteMenuItem_... object at 0...>] 
  >>> username, meinordner, prefs, logout = manager.viewlets

Username:

  >>> print username.render()
  <a href="#">  A User </a>

MeinOrdner:

  >>> print meinordner.render()
  <a href='http://127.0.0.1'> Mein Ordner </a>


Footer
------

   >>> manager = getMultiAdapter((context, request, view), IContentProvider, name=u"uvcsite.footer")
   >>> manager 
   <uvc.layout.menus.Footer object ...>

Show the Viewlets:

   >>> manager.update()
   >>> len(manager.viewlets)
   2 

   >>> for x in manager.viewlets:
   ...     print x
   <megrok.navigation.util.AutoSiteMenuItem_... object at ...>


PersonalMenu
------------

   >>> manager = getMultiAdapter((context, request, view), IContentProvider, name=u"uvc.user.menu")
   >>> manager 
   <uvc.layout.menus.PersonalMenu object ...>

Show the Viewlets:

   >>> manager.update()
   >>> for x in manager.viewlets:
   ...     print x
   <megrok.navigation.util.AutoSiteMenuItem_...>

GlobalMenu
----------

   >>> manager = getMultiAdapter((context, request, view), IContentProvider, name=u"uvc.global.menu")
   >>> manager 
   <uvc.layout.menus.GlobalMenu object ...>

Show the Viewlets:

   >>> manager.update()
   >>> len(manager.viewlets)
   4


   >>> zope.security.management.endInteraction()

